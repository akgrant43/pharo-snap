name: pharo
version: 1.3.0
summary: Pharo 6 Smalltalk
description: |
    This package contains the 6.0 threaded VM and image.
    
    Available commands:
        pharo runs the vm in headless mode.
        pharo.ui runs the vm with display.
        pharo.cleanvm copies the image and changes file to the working directory.
        pharo.getvm copies the latest 6.0 VM from http://get.pharo.org
        pharo.sqlite3 runs the sqlite3 command line utility.
        pharo.config configures system thread priority, see below.
    System Configuration:
        This Pharo VM uses a threaded heartbeat that requires elevated priority.
        Permission is granted by creating /etc/security/limits.d/pharo.conf
        with the appropriate contents.  Running pharo.config will create or
        overwrite the configuration file.  This command must be run as root:
        $ sudo pharo.config
        This command only needs to be run once, and you must log out and 
        back in for the changes to take effect.
    Web Site:
        The Pharo web site: http://pharo.org/
        Snapcraft package source: https://github.com/akgrant43/pharo-snap
grade: devel
confinement: classic

apps:
  pharo:
    command: bin/desktop-launch $SNAP/usr/bin/pharo
    plugs: [home, unity7, opengl, network, x11]
  ui:
    command: bin/desktop-launch $SNAP/usr/bin/pharo-ui
    plugs: [home, unity7, opengl, network, x11]
  sqlite3:
    command: usr/bin/sqlite3
    plugs: [home]
  cleanvm:
    command: usr/bin/cleanvm
    plugs: [home]
  getvm:
    command: usr/bin/getvm
    plugs: [home]
  config:
    command: usr/bin/CONFIG
    plugs: [home]


parts:
  pharo:
    source: ./
    plugin: make
    after:
        - desktop-glib-only

  xdg-open:
    plugin: autotools
    source: https://github.com/snapcore/snapd-xdg-open.git
    source-type: git
    build-packages:
      - libglib2.0-dev
      - cmake
      - openssh-server
      - libtool
      - automake
      - autoconf
      - build-essential
      - ack-grep
      - zip
      - bash-completion
      - ruby
      - xz-utils
      - debhelper
      - devscripts
      - gcc-multilib
      - g++
      - uuid-dev:i386
      - libssl1.0.0:i386
      - libssl-dev:i386
      - patchelf
      - unzip
    stage-packages:
      - gcc-multilib
      - libc-bin:i386
      - libx11-6:i386
      - libgl1-mesa-glx:i386
      - libfontconfig1:i386
      - libssl1.0.0:i386
      - libcairo2-dev:i386
      - libc6:i386
      - libexpat1:i386
      - libgnome2-bin
      - libasound2:i386
      - libasound2-dev:i386
      - libasound2-plugins:i386
      - libssl-dev:i386
      - libfreetype6-dev:i386
      - libsm-dev:i386
      - libice-dev:i386
      - libgl1-mesa-dev:i386
      - libxext-dev:i386
      - libglapi-mesa:i386
      - uuid-dev:i386
      - sqlite3
      - libsqlite3-dev:i386
      - git
      - vim
      - curl
      - unzip
      - locales-all

